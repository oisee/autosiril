Autosiril - это инструмент для конвертирования midi в текстовый формат Vortex Tracker Improved (с возможностью последующего сохранения в формате ProTracker3.4).

> 📖 **Полная документация на английском языке доступна в файле README.md** - там содержится детальное описание всех параметров, примеры использования и советы по конвертации.

Инструмент состоит из основных файлов:

* autosiril.rb       - основной рабочий файл (стабильная версия)
* main.rb           - рефакторинговая версия (в разработке, использовать только для тестирования/сравнения)
* module_template.rb - вспомогательный файл, в котором находится шаблон модуля VortexTracker'а. Вы можете изменять в нём семплы или любую другую информацию (однако следует учитывать, что при конвертировании ударников конвертор рассчитывает на то, что определённые типы ударников должны соответсвовать конкретным семплам.)

⚠️ **Важно**: Всегда используйте autosiril.rb - это стабильная, рабочая версия. Файл main.rb - это попытка рефакторинга, которая была отменена из-за проблем (см. git-коммит "revert to previous working version").

Краткая инструкция по параметрам конвертора:

ruby autosiril.rb <file.mid> <channel1>,<channel2>,<channel3> N1 N2 N3 N4 N5 N6 N7

Для примера:

ruby autosiril.rb imrav.mid 2me[2f]-6p[3]+,3m[1e]-7m[6d]-6p[3]+-2mew+,4m[3c]-5m[2b]+-2me+ 8 6 12 0 64 2 24

autosiril.rb     - название исполняемого файла
<file.mid>       - путь к MIDI-файлу формата SMF1
<channel1>,<channel2>,<channel3> - опции даунмикса миди-треков в каналы 1,2,3 редактора VortexTracker Improved. (см.ниже)
N1               - строчек на 1/4 ноту (beat) (по-умолчанию 4, при этом на такт в редакторе VTi будет приходиться 4*4=16 строчек и паттерн из 64 строчек будет содержать 4 такта)
N2               - смещение в строчках для первичного эха (по-умолчанию 3)
N3               - смещение в строчках для вторичного эха (по-умолчанию 6)
N4               - размер паттерна в строчках (по-умолчанию 64, максимум - 255)
N5               - смещение в строчках до начала информации о нотах (по-умолчанию 0) - используется, если в начале миди-трека есть пауза
N6               - позиций орнамента на одну ноту аккорда (обычно 1 или 2, при конвертировании аккорда в орнамент каждой ноте аккорда будет соответствовать указанное количество позиций орнамента)
N7               - количество полутонов от медианной ноты аккорда, характеризующее "ширину" аккорда, который будет взят для анализа и превращения в орнамент. если количество орнаментов в сконвертированном модуле превышает 15 - то имеет смысл уменьшить этот параметр, либо вручную провести оптимизацию аккордов в исходном миди-треке.

<channelN> - Настройки даунмикса миди-дорожек в каналы VortexTracker Improved.
			 Содержит перечисление миди-дорожек, их тип, приоритет при смешивании, свойства смешивания.
			 Если в один канал смешивается более одной дорожки они разделяются знаком "-":
			 1m-2m
			 приоритет уменьшается слева направо (слева - наиболее приоритетная дорожка), в примере 1m-2m - дорожка 1 приоритетнее дорожки 2.
			 
			 Типы дорожек:
			 	d - (Drums) - ударные.
			 	m - (Mono melody) - мелодия (монофония) - аккорды на дорожке с этим типом будут преобразованы в одну ноту (самую высокую ноту аккорда)
			 	p - (Polyphonic melody) - гармония (полифония) - аккорды на дорожке с этим типом будут преобразованы в орнаменты.
			 Тип дорожки указывается вслед за её номером: "1m" или "2p" или "4d".
			 
			 Подтип дорожки:
			 	e - (Envelope) - сочетается с дорожкой типа "m", указывается после типа, применяется в основном для басов, ноты будут преобразованы с использованием огибающей: "1me".
			 
			 Модификаторы свойств дорожек:
			 	u - (mUte echo) - для данной дорожки эхо не будет генерироваться
			 	w - (double echo) - эхо будет в 2 раза длиннее (см. параметы N2 и N3).
			 Модификатор указывается после типа дорожки: 
			 		1du - у ударников не будет эха.
			 		2mew - у огибающей будет удвоенное эхо.
			 		3pw - у гармонии (аккордов, преобразованных в орнаменты) будет удвоенное эхо.
			 		
			 Опция смешивания:
			 	+ - (plus) - опция указывается после модификатора дорожки, указывает на то, что если текущая позиция в модуле VTi уже занята нотой из предыдущей (левой, более приоритетной дорожки) то нота из текущей дорожки пропустится.
			 	по-умолчанию (без опции "+") если текущая позиция в модуле VTi уже занята нотой из предыдущей (левой, более приоритетной дорожки) то нота из текущей дорожки будет вставлена в следующую строчку (то есть прозвучит чуть позднее).
			 	Пример: 1d-2me-6p+ 
			 		Уданик из дорожки 1 (1d) будет установлен в первую очередь, если в дорожке 2 (2me) есть бас, то он будет установлен ниже, затем в самую последнюю очередь будет попытка установить аккорд из дорожки 6 (6p+), однако если в предыдущих дорожках была хоть одна нота, то аккорд пропустится.
			 		
			 		
			 Опции присваивания конкретных семплов и орнаментов смешиваемым дорожкам:
			 	[SO] - (Sample Ornament). После модификатора свойств дорожки может быть выполнено присваивание данной дорожке конкретного номера семпла или семпла с орнаментом: 2me[2f]-6p[3]+
			 		нота из дорожки 2 будет поставлена с огибающей, вторым семплом, с орнаментом "F" (15), а нота из дорожки 6 будет поставлена с семплом 3 (так как это "полифоническая" дорожка орнаменты к которой присваиваются автоматически, ручное присваивание орнамента - игнорируется).
			 		
			 		
			 Для тестирования работы конвертора вы можете запустить прилагаемые .bat/.sh файлы:
			 	test_flim.bat
				test_imrav_hard.bat
				test_imrav_medium.bat
				test_imrav_simple.bat
				test_tottoro.bat
			которые сконвертируют прилагаемые .mid модули с разными настройками в текстовый файл VortexTracker Improved.
			
			VortexTracker Improved (VortexTracker улучшенный by oisee/siril^4d) - находится в соответствующей папке. (Последняя версия может быть найдена на форуме zx.pk.ru).

P.S. Общие рекомендации по преобразованию midi в VTi:

Самым приоритетным треком в канале выбирайте ударники или бас.
Часто для ударников можно отключить эхо и звук будет лучше. "1du"
Бас интереснее конвертировать с опцией "e" (envelope). "2me"
Не стесняйтесь конвертировать с опцией "е" дорожки на разные каналы одновременно - конфликты на огибающей разрешаются автоматически.
Часто ударники и бас могут быть замиксованы в один канал, ударники приоритетнее баса. "1du-2me"
Часто в тот же канал может быть втиснута и гармония (аккорды, дорожка с опцией "p"). "1du-2me-3p"
Если миди-трек имеет BPM около 125, то первые три цифровые параметра (N1, N2, N3) могут быть 4 3 6 или 4 6 12.
Если BPM ниже или выше - имеет смысл попробовать 8 6 12 или 8 12 24 и поставить темп 3 (в VortexTracker'е).
Если размер не 4/4, а 3/4, или в MIDI-треке используется ярковыраженная синкопа, попробуйте отдать под четвёртую ноту 12 линий. то есть первые три параметра 6 0 0 или 12 0 0 (значение эха - потом подберёте).
Для миди модулей, в которых используется размер 3/4 имеет смысл задавать длину паттерна (N5) - 48 или 96 линий.
Если модуль не загружается в VTi — возможно у вас получилось слишком много паттернов или орнаментов (больше 15-ти), проверьте входные данные, уменьшите "ширину" аккордов, чтобы больше аккордов совпали и преобразовались в одинаковые орнаменты. либо оптимизируйте аккорды в секвенсоре. либо удалите "лишние" орнаменты из текста модуля — модуль загрузится, но аккорды на орнаментах нужно будет проверить и прослушать их корректность вручную, в VTi.